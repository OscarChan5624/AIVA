#:import utils kivy.utils
#:import dp kivy.metrics.dp

<SecurityPasswordScreen@Screen>:
    name: 'security_password'
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: utils.get_color_from_hex('#101024')
            Rectangle:
                pos: self.pos
                size: self.size
        
        # Header with back button
        BoxLayout:
            size_hint_y: None
            height: dp(64)
            padding: dp(16), dp(12)
            spacing: dp(12)
            Button:
                text: '< Back'
                size_hint_x: None
                width: dp(90)
                background_normal: ''
                background_color: utils.get_color_from_hex('#2d2d48')
                color: 1, 1, 1, 1
                on_release: app.back_to_profile()
            Label:
                text: 'Security & Password'
                color: 1, 1, 1, 1
                font_size: '20sp'
                bold: True
                halign: 'left'
                valign: 'middle'
                text_size: self.size
            Widget:
                size_hint_x: None
                width: dp(48)
        
        # Scrollable content
        ScrollView:
            do_scroll_x: False
            bar_color: 1, 1, 1, .2
            bar_inactive_color: 1, 1, 1, .1
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: dp(20)
                spacing: dp(20)
                
                Label:
                    text: 'Manage your account security settings'
                    color: 0.81, 0.82, 1, 1
                    font_size: '14sp'
                    size_hint_y: None
                    height: dp(24)
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.size
                
                # Change Password Card
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(20)
                    spacing: dp(16)
                    canvas.before:
                        Color:
                            rgba: utils.get_color_from_hex('#262642')
                        RoundedRectangle:
                            radius: [20,]
                            pos: self.pos
                            size: self.size
                    
                    Label:
                        text: 'Change Password'
                        color: 0.3, 0.98, 0.6, 1
                        font_size: '16sp'
                        bold: True
                        size_hint_y: None
                        height: dp(30)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    
                    # Current Password
                    Label:
                        text: 'Current Password'
                        color: 1, 1, 1, 1
                        font_size: '14sp'
                        size_hint_y: None
                        height: dp(22)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    TextInput:
                        id: current_password
                        hint_text: 'Enter current password'
                        size_hint_y: None
                        height: dp(44)
                        multiline: False
                        password: True
                        background_normal: ''
                        background_color: utils.get_color_from_hex('#1b1b30')
                        foreground_color: 1, 1, 1, 1
                        cursor_color: 0.3, 0.98, 0.6, 1
                        padding: dp(10), dp(12)
                    
                    # New Password
                    Label:
                        text: 'New Password'
                        color: 1, 1, 1, 1
                        font_size: '14sp'
                        size_hint_y: None
                        height: dp(22)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    TextInput:
                        id: new_password
                        hint_text: 'Enter new password'
                        size_hint_y: None
                        height: dp(44)
                        multiline: False
                        password: True
                        background_normal: ''
                        background_color: utils.get_color_from_hex('#1b1b30')
                        foreground_color: 1, 1, 1, 1
                        cursor_color: 0.3, 0.98, 0.6, 1
                        padding: dp(10), dp(12)
                        on_text: app.update_password_strength(self.text)
                    
                    # Confirm Password
                    Label:
                        text: 'Confirm New Password'
                        color: 1, 1, 1, 1
                        font_size: '14sp'
                        size_hint_y: None
                        height: dp(22)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    TextInput:
                        id: confirm_password
                        hint_text: 'Re-enter new password'
                        size_hint_y: None
                        height: dp(44)
                        multiline: False
                        password: True
                        background_normal: ''
                        background_color: utils.get_color_from_hex('#1b1b30')
                        foreground_color: 1, 1, 1, 1
                        cursor_color: 0.3, 0.98, 0.6, 1
                        padding: dp(10), dp(12)
                    
                    # Password Strength Indicator
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: None
                        height: dp(24)
                        spacing: dp(10)
                        Label:
                            text: 'Strength:'
                            color: 0.81, 0.82, 1, 1
                            font_size: '13sp'
                            size_hint_x: None
                            width: dp(70)
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.size
                        Widget:
                            id: strength_bar_container
                            size_hint: 1, None
                            height: dp(8)
                            pos_hint: {'center_y': 0.5}
                            canvas.before:
                                Color:
                                    rgba: 0.3, 0.3, 0.4, 1
                                RoundedRectangle:
                                    radius: [4,]
                                    pos: self.pos
                                    size: self.size
                        Label:
                            id: strength_label
                            text: ''
                            color: 0.81, 0.82, 1, 1
                            font_size: '13sp'
                            size_hint_x: None
                            width: dp(70)
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                    
                    # Update Password Button
                    Button:
                        text: 'Update Password'
                        size_hint_y: None
                        height: dp(50)
                        background_normal: ''
                        background_color: 0.3, 0.98, 0.6, 1
                        color: 0, 0, 0, 1
                        font_size: '16sp'
                        bold: True
                        on_release: app.change_password()
                
                # App Security Card
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(20)
                    spacing: dp(16)
                    canvas.before:
                        Color:
                            rgba: utils.get_color_from_hex('#262642')
                        RoundedRectangle:
                            radius: [20,]
                            pos: self.pos
                            size: self.size
                    
                    Label:
                        text: 'App Security'
                        color: 0.66, 0.55, 0.98, 1
                        font_size: '16sp'
                        bold: True
                        size_hint_y: None
                        height: dp(30)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    
                    # App Lock Toggle
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: None
                        height: dp(40)
                        spacing: dp(12)
                        Label:
                            text: 'App Lock / PIN'
                            color: 1, 1, 1, 1
                            font_size: '14sp'
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.size
                        CheckBox:
                            id: app_lock_toggle
                            size_hint: None, None
                            size: dp(32), dp(32)
                            active: False
                            on_active: app.toggle_app_lock(self.active)
                    
                    Label:
                        text: 'Protect your app with a PIN code'
                        color: 0.81, 0.82, 1, 1
                        font_size: '12sp'
                        size_hint_y: None
                        height: dp(30)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                
                # Login History Card
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(20)
                    spacing: dp(16)
                    canvas.before:
                        Color:
                            rgba: utils.get_color_from_hex('#262642')
                        RoundedRectangle:
                            radius: [20,]
                            pos: self.pos
                            size: self.size
                    
                    Label:
                        text: 'Login History'
                        color: 0.3, 0.98, 0.6, 1
                        font_size: '16sp'
                        bold: True
                        size_hint_y: None
                        height: dp(30)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    
                    Label:
                        text: 'Recent login activity:'
                        color: 0.81, 0.82, 1, 1
                        font_size: '13sp'
                        size_hint_y: None
                        height: dp(25)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    
                    # Login entries (will be populated dynamically)
                    BoxLayout:
                        id: login_history_container
                        orientation: 'vertical'
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(8)
                        
                        Label:
                            text: '* Last login: Just now'
                            color: 1, 1, 1, 1
                            font_size: '13sp'
                            size_hint_y: None
                            height: dp(28)
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.size
                        Label:
                            text: '* Previous: Check login history for details'
                            color: 0.81, 0.82, 1, 1
                            font_size: '13sp'
                            size_hint_y: None
                            height: dp(28)
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.size
                
                # Security Tips Card
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(20)
                    spacing: dp(12)
                    canvas.before:
                        Color:
                            rgba: utils.get_color_from_hex('#262642')
                        RoundedRectangle:
                            radius: [20,]
                            pos: self.pos
                            size: self.size
                    
                    Label:
                        text: 'Security Tips'
                        color: 0.66, 0.55, 0.98, 1
                        font_size: '16sp'
                        bold: True
                        size_hint_y: None
                        height: dp(30)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    
                    Label:
                        text: '* Use a strong, unique password'
                        color: 1, 1, 1, 1
                        font_size: '13sp'
                        size_hint_y: None
                        height: dp(28)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    Label:
                        text: '* Change your password regularly'
                        color: 1, 1, 1, 1
                        font_size: '13sp'
                        size_hint_y: None
                        height: dp(28)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    Label:
                        text: '* Enable app lock for extra security'
                        color: 1, 1, 1, 1
                        font_size: '13sp'
                        size_hint_y: None
                        height: dp(28)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                    Label:
                        text: '* Never share your password'
                        color: 1, 1, 1, 1
                        font_size: '13sp'
                        size_hint_y: None
                        height: dp(28)
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size
                
                # Bottom spacing
                Widget:
                    size_hint_y: None
                    height: dp(20)

